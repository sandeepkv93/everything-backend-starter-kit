apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  labels:
    app.kubernetes.io/name: secure-observable-api
    app.kubernetes.io/component: config
data:
  APP_ENV: development
  HTTP_PORT: "8080"

  JWT_ISSUER: secure-observable-go-backend-starter-kit
  JWT_AUDIENCE: secure-observable-go-backend-starter-kit-api
  JWT_ACCESS_TTL: 15m
  JWT_REFRESH_TTL: 168h

  COOKIE_DOMAIN: ""
  COOKIE_SECURE: "false"
  COOKIE_SAMESITE: lax
  CORS_ALLOWED_ORIGINS: http://localhost:3000,http://localhost:5173

  AUTH_LOCAL_ENABLED: "true"
  AUTH_LOCAL_REQUIRE_EMAIL_VERIFICATION: "false"
  AUTH_GOOGLE_ENABLED: "false"
  AUTH_EMAIL_VERIFY_TOKEN_TTL: 30m
  AUTH_EMAIL_VERIFY_BASE_URL: http://localhost:3000/verify-email
  AUTH_PASSWORD_RESET_TOKEN_TTL: 15m
  AUTH_PASSWORD_RESET_BASE_URL: http://localhost:3000/reset-password
  AUTH_PASSWORD_FORGOT_RATE_LIMIT_PER_MIN: "5"

  BOOTSTRAP_ADMIN_EMAIL: admin@example.com
  RBAC_PROTECTED_ROLES: admin,user
  RBAC_PROTECTED_PERMISSIONS: users:read,users:write,roles:read,roles:write,permissions:read,permissions:write

  AUTH_RATE_LIMIT_PER_MIN: "30"
  API_RATE_LIMIT_PER_MIN: "120"
  RATE_LIMIT_LOGIN_PER_MIN: "20"
  RATE_LIMIT_REFRESH_PER_MIN: "30"
  RATE_LIMIT_ADMIN_WRITE_PER_MIN: "30"
  RATE_LIMIT_ADMIN_SYNC_PER_MIN: "10"
  RATE_LIMIT_BURST_MULTIPLIER: "1.5"
  RATE_LIMIT_SUSTAINED_WINDOW: 1m
  RATE_LIMIT_REDIS_OUTAGE_POLICY_API: fail_open
  RATE_LIMIT_REDIS_OUTAGE_POLICY_AUTH: fail_closed
  RATE_LIMIT_REDIS_OUTAGE_POLICY_FORGOT: fail_closed
  RATE_LIMIT_REDIS_OUTAGE_POLICY_ROUTE_LOGIN: fail_closed
  RATE_LIMIT_REDIS_OUTAGE_POLICY_ROUTE_REFRESH: fail_closed
  RATE_LIMIT_REDIS_OUTAGE_POLICY_ROUTE_ADMIN_WRITE: fail_closed
  RATE_LIMIT_REDIS_OUTAGE_POLICY_ROUTE_ADMIN_SYNC: fail_closed
  RATE_LIMIT_REDIS_ENABLED: "true"
  RATE_LIMIT_REDIS_PREFIX: rl

  AUTH_ABUSE_PROTECTION_ENABLED: "true"
  AUTH_ABUSE_FREE_ATTEMPTS: "3"
  AUTH_ABUSE_BASE_DELAY: 2s
  AUTH_ABUSE_MULTIPLIER: "2.0"
  AUTH_ABUSE_MAX_DELAY: 5m
  AUTH_ABUSE_RESET_WINDOW: 30m
  AUTH_ABUSE_REDIS_PREFIX: auth_abuse
  AUTH_BYPASS_INTERNAL_PROBES: "true"
  AUTH_BYPASS_TRUSTED_ACTORS: "false"
  AUTH_BYPASS_TRUSTED_ACTOR_CIDRS: ""
  AUTH_BYPASS_TRUSTED_ACTOR_SUBJECTS: ""

  ADMIN_LIST_CACHE_ENABLED: "true"
  ADMIN_LIST_CACHE_TTL: 30s
  ADMIN_LIST_CACHE_REDIS_PREFIX: admin_list_cache
  NEGATIVE_LOOKUP_CACHE_ENABLED: "true"
  NEGATIVE_LOOKUP_CACHE_TTL: 15s
  NEGATIVE_LOOKUP_CACHE_REDIS_PREFIX: negative_lookup_cache
  RBAC_PERMISSION_CACHE_ENABLED: "true"
  RBAC_PERMISSION_CACHE_TTL: 5m
  RBAC_PERMISSION_CACHE_REDIS_PREFIX: rbac_perm

  IDEMPOTENCY_ENABLED: "true"
  IDEMPOTENCY_REDIS_ENABLED: "true"
  IDEMPOTENCY_TTL: 24h
  IDEMPOTENCY_DB_CLEANUP_ENABLED: "true"
  IDEMPOTENCY_DB_CLEANUP_INTERVAL: 5m
  IDEMPOTENCY_DB_CLEANUP_BATCH_SIZE: "500"
  IDEMPOTENCY_REDIS_PREFIX: idem

  REDIS_ADDR: redis:6379
  REDIS_DB: "0"
  REDIS_KEY_NAMESPACE: v1
  REDIS_USERNAME: ""
  REDIS_TLS_ENABLED: "false"
  REDIS_TLS_SERVER_NAME: ""
  REDIS_TLS_CA_CERT_FILE: ""
  REDIS_TLS_INSECURE_SKIP_VERIFY: "false"
  REDIS_DIAL_TIMEOUT: 5s
  REDIS_READ_TIMEOUT: 3s
  REDIS_WRITE_TIMEOUT: 3s
  REDIS_MAX_RETRIES: "3"
  REDIS_MIN_RETRY_BACKOFF: 8ms
  REDIS_MAX_RETRY_BACKOFF: 512ms
  REDIS_POOL_SIZE: "10"
  REDIS_MIN_IDLE_CONNS: "2"
  REDIS_POOL_TIMEOUT: 4s

  READINESS_PROBE_TIMEOUT: 1s
  SERVER_START_GRACE_PERIOD: 2s
  SHUTDOWN_TIMEOUT: 20s
  SHUTDOWN_HTTP_DRAIN_TIMEOUT: 10s
  SHUTDOWN_OBSERVABILITY_TIMEOUT: 8s

  OTEL_SERVICE_NAME: secure-observable-go-backend-starter-kit
  OTEL_ENVIRONMENT: development
  OTEL_LOG_LEVEL: info
  OTEL_METRICS_ENABLED: "false"
  OTEL_TRACING_ENABLED: "false"
  OTEL_LOGS_ENABLED: "false"
